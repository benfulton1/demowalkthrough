<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Interior Elite Demolition Walkthrough v1.6</title>
  <!-- Montserrat font -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    body { font-family: 'Montserrat', sans-serif; background: #f4f4f4; color: #333; margin: 0; padding: 0; }
    .header { background: #E65C00; color: #fff; display: flex; align-items: center; padding: 10px 20px; }
    .header img { height: 40px; margin-right: 15px; }
    .header h1 { font-size: 1.5em; margin: 0; }
    .container { max-width: 800px; margin: 20px auto; padding: 20px; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #E65C00; margin-bottom: 20px; }
    fieldset { border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px; padding: 15px; }
    legend { font-weight: 600; color: #444; font-size: 1.1em; }
    label { display: block; margin-bottom: 6px; font-weight: 500; }
    input[type="text"], input[type="tel"], textarea, select { width: 100%; padding: 8px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 4px; }
    textarea { min-height: 60px; resize: vertical; }
    .btn { display: block; width: 100%; padding: 12px; border: none; border-radius: 4px; font-weight: 600; cursor: pointer; margin-bottom: 12px; }
    .btn-primary { background: #E65C00; color: #fff; }
    .btn-primary:hover { background: #cc5000; }
    .btn-secondary { background: #007ACC; color: #fff; }
    .btn-secondary:hover { background: #006bb3; }
    .btn-custom { background: #444; color: #fff; }
    .btn-custom:hover { background: #333; }
    .personnel-item, .checklist-item, .task-item { display: flex; flex-wrap: wrap; align-items: center; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
    .personnel-item select { flex: 0 0 30%; margin-right: 10px; }
    .personnel-item input { flex: 0 0 calc(35% - 10px); margin-right: 10px; }
    .checklist-item label, .task-item label { flex: 1; display: flex; align-items: center; }
    .checklist-item label input, .task-item label input { margin-right: 8px; }
    .note-input { width: 100%; padding: 6px; margin-top: 6px; border: 1px solid #ccc; border-radius: 4px; display: none; }
    .task-controls { margin-left: auto; }
    .task-controls select { padding: 6px; border-radius: 4px; border: 1px solid #ccc; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <header class="header">
    <img src="https://kamloopsbuilders.ca/assets/logo.png" alt="Interior Elite Logo">
    <h1>Interior Elite Contracting</h1>
  </header>
  <div class="container" id="mainContainer">
    <h2>Demolition Walkthrough v1.6</h2>
    <form id="demoForm">
      <fieldset>
        <legend>Project Info</legend>
        <label>Site Address<input type="text" id="siteAddress" placeholder="Enter site address"></label>
        <label>Client Name<input type="text" id="clientName" placeholder="Enter client name"></label>
        <button type="button" id="captureLocationBtn" class="btn btn-custom">Capture Site Location</button>
        <div id="siteLocationDisplay" style="margin-bottom:12px;font-size:0.9em;color:#555;"></div>
      </fieldset>
      <fieldset>
        <legend>Personnel on Site</legend>
        <button type="button" id="addPersonnelBtn" class="btn btn-primary">+ Add Personnel</button>
        <div id="personnelContainer"></div>
      </fieldset>
      <fieldset>
        <legend>Site Conditions</legend>
        <div id="siteConditionsList"></div>
      </fieldset>
      <fieldset>
        <legend>Site Security</legend>
        <div id="siteSecurityList"></div>
      </fieldset>
      <fieldset>
        <legend>Special Client Requests</legend>
        <div id="specialRequestsList"></div>
      </fieldset>
      <fieldset>
        <legend>Rooms & Tasks</legend>
        <button type="button" id="addRoomBtn" class="btn btn-primary">+ Add Room</button>
        <div id="roomsContainer"></div>
      </fieldset>
      <button type="button" id="toPdfBtn" class="btn btn-secondary">Convert to PDF</button>
      <button type="button" id="toWorkOrderBtn" class="btn btn-secondary">Convert to Work Order</button>
    </form>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Form and dynamic fields setup (unchanged) ...
      // [Keep all of your existing walkthrough setup code here. Omitted for brevity.]

      // --- PDF Export (Letter Portrait with Margin) ---
      document.getElementById('toPdfBtn').addEventListener('click', async () => {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({ unit: 'pt', format: 'letter', orientation: 'portrait' });
        const canvas = await html2canvas(document.getElementById('mainContainer'), { scale: 2 });
        const img = canvas.toDataURL('image/png');
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
        let heightLeft = pdfHeight; let position = 0;
        pdf.addImage(img, 'PNG', 40, position + 40, pdfWidth - 80, pdfHeight - 80);
        heightLeft -= pdf.internal.pageSize.getHeight();
        while (heightLeft > 0) {
          position = heightLeft - pdfHeight; pdf.addPage();
          pdf.addImage(img, 'PNG', 40, position + 40, pdfWidth - 80, pdfHeight - 80);
          heightLeft -= pdf.internal.pageSize.getHeight();
        }
        pdf.save('Demolition_Walkthrough.pdf');
      });

      // --- SIMPLE STATIC WORK ORDER GENERATION ---
      document.getElementById('toWorkOrderBtn').addEventListener('click', () => {
        // Remove any existing modal
        document.getElementById('simpleWorkOrder')?.remove();

        // Modal wrapper
        const container = document.createElement('div');
        container.id = 'simpleWorkOrder';
        container.style = `
          position: fixed;
          top: 0; left: 0;
          width: 100vw; height: 100vh;
          background: rgba(245,245,245,0.99);
          color: #222;
          padding: 0;
          z-index: 9999;
          overflow: auto;
          font-family: Montserrat, sans-serif;
        `;

        // Content card for shadow/background
        const card = document.createElement('div');
        card.style = `
          background: #fff;
          margin: 40px auto 40px auto;
          max-width: 700px;
          box-shadow: 0 8px 32px rgba(0,0,0,0.12);
          border-radius: 16px;
          padding: 32px 24px 32px 24px;
        `;

        // Build Work Order HTML
        let html = `<div style="text-align:center;margin-bottom:12px;">
            <img src="https://kamloopsbuilders.ca/assets/logo.png" style="height:48px;margin-bottom:10px;">
            <h2 style="color:#E65C00;margin:0 0 4px 0;">Work Order</h2>
          </div>
          <div style="margin-bottom:12px;">
            <strong>Address:</strong> ${document.getElementById('siteAddress').value || ""}
          </div>
          <div style="margin-bottom:16px;">
            <strong>Client:</strong> ${document.getElementById('clientName').value || ""}
          </div>
          <hr style="margin:16px 0 20px 0;">`;

        // Checklist Items
        html += `<div style="margin-bottom:18px;"><strong style="color:#E65C00;">Checklist</strong><ul style="margin:0 0 0 22px;padding:0;">`;
        [['Site Conditions','siteConditionsList'],['Site Security','siteSecurityList'],['Special Client Requests','specialRequestsList']].forEach(([label, id]) => {
          document.querySelectorAll(`#${id} input[type=checkbox]:checked`).forEach(chk => {
            const note = document.getElementById(`${id}-note-${chk.id.split('-').pop()}`)?.value || "";
            html += `<li style="margin-bottom:7px;">☑ <span style="font-weight:500;">${chk.value}</span>${note ? `<span style='display:block;margin-left:25px;color:#666;font-size:0.95em;'>Note: ${note}</span>` : ''}</li>`;
          });
        });
        html += `</ul></div>`;

        // Room Tasks
        document.querySelectorAll('#roomsContainer fieldset').forEach(fs => {
          const room = fs.querySelector('select').value;
          const tasks = fs.querySelectorAll('.task-item');
          const checked = Array.from(tasks).filter(t => t.querySelector('input[type=checkbox]').checked);
          if (checked.length > 0) {
            html += `<div style="margin-top:12px;"><strong>${room}</strong><ul style="margin:0 0 0 22px;padding:0;">`;
            checked.forEach(t => {
              const name = t.querySelector('label').textContent.trim();
              const action = t.querySelector('select').value;
              html += `<li style="margin-bottom:5px;">☑ ${name} <span style="color:#666;font-size:0.96em;">— ${action}</span></li>`;
            });
            html += `</ul></div>`;
          }
        });

        // Download and Close buttons
        html += `<div style="text-align:right;margin-top:28px;">
            <button class="btn btn-primary" onclick="downloadWorkOrderAsImage()" style="width:auto;display:inline-block;padding:10px 24px;font-size:1.12em;">Download as JPEG</button>
            <button class="btn btn-custom" onclick="document.getElementById('simpleWorkOrder').remove()" style="width:auto;display:inline-block;padding:10px 20px;margin-left:12px;">Close</button>
          </div>`;

        card.innerHTML = html;
        container.appendChild(card);
        document.body.appendChild(container);
      });

      // JPEG Export Function for Work Order
      window.downloadWorkOrderAsImage = function() {
        const card = document.querySelector('#simpleWorkOrder > div');
        html2canvas(card, {backgroundColor: "#fff", scale: 2}).then(canvas => {
          const link = document.createEl

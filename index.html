<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Interior Elite Demolition Walkthrough v1.7</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet"/>
<style>
  body { font-family: 'Montserrat',sans-serif; background:#f4f4f4; color:#333; margin:0; padding:0; }
  .header { background:#E65C00; color:#fff; display:flex; align-items:center; padding:10px 20px; }
  .header img { height:40px; margin-right:15px; }
  .header h1 { font-size:1.5em; margin:0; }
  .container { max-width:800px; margin:20px auto; padding:20px; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
  h2 { text-align:center; color:#E65C00; margin-bottom:20px; }
  fieldset { border:1px solid #ddd; border-radius:8px; margin-bottom:20px; padding:15px; }
  legend { font-weight:600; color:#444; font-size:1.1em; }
  label { display:block; margin-bottom:6px; font-weight:500; }
  input[type="text"], input[type="tel"], textarea, select { width:100%; padding:8px; margin-bottom:12px; border:1px solid #ccc; border-radius:4px; }
  textarea { min-height:60px; resize:vertical; }
  .btn { display:block; width:100%; padding:12px; border:none; border-radius:4px; font-weight:600; cursor:pointer; margin-bottom:12px; }
  .btn-primary { background:#E65C00; color:#fff; } .btn-primary:hover { background:#cc5000; }
  .btn-secondary { background:#007ACC; color:#fff; } .btn-secondary:hover { background:#006bb3; }
  .btn-custom { background:#444; color:#fff; } .btn-custom:hover { background:#333; }
  .personnel-item, .checklist-item, .task-item { display:flex; flex-wrap:wrap; align-items:center; margin-bottom:10px; padding-bottom:10px; border-bottom:1px solid #eee; }
  .personnel-item select { flex:0 0 30%; margin-right:10px; }
  .personnel-item input { flex:0 0 calc(35% - 10px); margin-right:10px; }
  .checklist-item label, .task-item label { flex:1; display:flex; align-items:center; }
  .note-input { width:100%; padding:6px; margin-top:6px; border:1px solid #ccc; border-radius:4px; display:none; }
  .task-controls { margin-left:auto; }
  .task-controls select { padding:6px; border-radius:4px; border:1px solid #ccc; }
  .sig-field { margin:16px 0; } .sig-field canvas { border:1px solid #ccc; border-radius:4px; display:block; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
</head>
<body>
<header class="header">
  <img alt="Interior Elite Logo" src="https://kamloopsbuilders.ca/assets/logo.png"/>
  <h1>Interior Elite Contracting</h1>
</header>
<div class="container" id="mainContainer">
  <h2>Demolition Walkthrough v1.7</h2>
  <p><strong>Timestamp:</strong> <span id="formTimestamp"></span></p>
  <form id="demoForm">
    <fieldset><legend>Project Info</legend>
      <label>Site Address<input id="siteAddress" placeholder="Enter site address" type="text"/></label>
      <label>Client Name<input id="clientName" placeholder="Enter client name" type="text"/></label>
      <button class="btn btn-custom" id="captureLocationBtn" type="button">Capture Site Location</button>
      <div id="siteLocationDisplay" style="margin-bottom:12px;font-size:0.9em;color:#555;"></div>
    </fieldset>
    <fieldset><legend>Personnel on Site</legend>
      <button class="btn btn-primary" id="addPersonnelBtn" type="button">+ Add Personnel</button>
      <div id="personnelContainer"></div>
    </fieldset>
    <fieldset><legend>Site Conditions</legend><div id="siteConditionsList"></div></fieldset>
    <fieldset><legend>Site Security</legend><div id="siteSecurityList"></div></fieldset>
    <fieldset><legend>Special Client Requests</legend><div id="specialRequestsList"></div></fieldset>
    <fieldset><legend>Rooms &amp; Tasks</legend>
      <button class="btn btn-primary" id="addRoomBtn" type="button">+ Add Room</button>
      <div id="roomsContainer"></div>
    </fieldset>
    <div id="signatureContainer"></div>
    <button class="btn btn-secondary" id="saveJpgBtn" type="button" style="display:none;">Save copy of form</button>
  </form>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('formTimestamp').textContent = new Date().toLocaleString();
  const sigPads = [], peopleTypes = ["Project Manager","Designer","Client"];
  let personnelCount = 0;

  function updateSaveButton(){
    const allSigned = sigPads.length>0 && sigPads.every(p=>!p.isEmpty());
    document.getElementById('saveJpgBtn').style.display = allSigned?'block':'none';
  }
  document.getElementById('addPersonnelBtn').addEventListener('click', () => {
    const idx = personnelCount++;
    const container = document.getElementById('personnelContainer');
    const div = document.createElement('div');
    div.className = 'personnel-item';
    div.innerHTML = `
      <select name="personnel[${idx}][role]">${peopleTypes.map(pt=>`<option>${pt}</option>`).join('')}</select>
      <input type="text" name="personnel[${idx}][name]" placeholder="Name"/>
      <input type="tel" name="personnel[${idx}][phone]" placeholder="Phone"/>
    `;
    container.appendChild(div);

    const sigDiv = document.createElement('div');
    sigDiv.className = 'sig-field';
    sigDiv.innerHTML = `
      <label>Signature for ${idx + 1}:</label>
      <canvas id="sigCanvas_${idx}" width="400" height="120"></canvas>
      <button type="button" id="clearSig_${idx}">Clear</button>
    `;
    document.getElementById('signatureContainer').appendChild(sigDiv);

    const canvas = document.getElementById(`sigCanvas_${idx}`);
    const pad = new SignaturePad(canvas, { backgroundColor: 'rgba(255,255,255,0)' });
    sigPads.push(pad);

    document.getElementById(`clearSig_${idx}`).addEventListener('click', () => {
      pad.clear();
      updateSaveButton();
    });
    canvas.addEventListener('mouseup', updateSaveButton);
    canvas.addEventListener('touchend', updateSaveButton);
    updateSaveButton();
  });

  document.getElementById('saveJpgBtn').addEventListener('click', () => {
    html2canvas(document.getElementById('mainContainer'), {
      backgroundColor: '#fff', scale: 2
    }).then(canvas => {
      const link = document.createElement('a');
      link.download = 'Demolition_Walkthrough.jpg';
      link.href = canvas.toDataURL('image/jpeg', 0.95);
      link.click();
    });
  });

  // ========== CHECKLIST GENERATOR ==========
  function generateChecklist(id, opts) {
    const container = document.getElementById(id);
    opts.forEach((opt,i) => {
      const div = document.createElement('div'); div.className = 'checklist-item';
      const chk = document.createElement('input'); chk.type = 'checkbox'; chk.id = `${id}-chk-${i}`; chk.value = opt;
      const lbl = document.createElement('label'); lbl.htmlFor = chk.id; lbl.textContent = opt;
      const note = document.createElement('input'); note.type = 'text'; note.placeholder = 'Notes (optional)'; note.className = 'note-input'; note.id = `${id}-note-${i}`;
      chk.addEventListener('change', () => note.style.display = chk.checked ? 'block' : 'none');
      div.append(chk, lbl, note); container.append(div);
    });
  }

  const siteConditionsOptions = ["Site access restrictions","Ground conditions (muddy/rocky)","Water accumulation","Overhead hazards","Confined space","Noise sensitive area","Dust control measures","Traffic control required","Environmental protection zones","Asbestos identified","Lead paint identified","High wind exposure","Sloped terrain","Restricted working hours","Weather forecast monitoring"];
  const siteSecurityOptions = ["Perimeter fencing","Lockable gates","Warning signage","CCTV surveillance","Temporary lighting","Security guards","Access logs","Alarm systems","Fire watch","Visitor log","Key control","Lockout/tagout","Exit signage","Barriers"];
  const specialRequestsOptions = ["Salvage materials","Furniture protection","Debris staging","Separate waste streams","Client liaison","Restricted hours","Noise mitigation","Dust suppression","Landscaping protect","Structure protect","Third party coord","Photo documentation"];

  generateChecklist('siteConditionsList', siteConditionsOptions);
  generateChecklist('siteSecurityList', siteSecurityOptions);
  generateChecklist('specialRequestsList', specialRequestsOptions);

  // ========== ROOMS & TASKS ==========
  const roomList = ["Bathroom","Kitchen","Living Room","Bedroom","Dining Room","Home Office","Laundry Room","Garage","Basement","Attic","Patio","Deck","Porch","Hallway","Entryway","Staircase","Exterior Walls","Driveway","Sidewalk","Landscaping Area","Roof"];
  const standardTasks = ["Remove wall drywall","Remove ceiling drywall","Remove flooring","Remove doors","Remove trim/moulding","Remove baseboard trim","Asbestos review","Disconnect utilities","General cleanup","Debris removal"];
  const roomSpecificTasks = {
    "Bathroom":["Remove toilet","Remove bathtub/shower","Remove vanity","Remove countertop","Remove sink","Remove mirror","Remove medicine cabinet","Remove tile from walls","Remove tile from floor","Remove plumbing fixtures"],
    "Kitchen":["Remove cabinets","Remove countertops","Remove sink","Remove faucet","Remove appliances","Remove backsplash tile","Remove lighting fixtures","Remove island","Remove hood","Remove dishwasher"],
    "Living Room":["Remove drywall","Remove flooring","Remove trim","Remove baseboards","Remove windows","Remove built-in shelves","Remove fireplace","Remove lighting fixtures","Remove wall coverings","Remove vents"],
    "Bedroom":["Remove drywall","Remove flooring","Remove trim","Remove baseboards","Remove windows","Remove closet shelving","Remove lighting fixtures","Remove built-in furniture","Remove outlets","Remove vents"],
    "Dining Room":["Remove drywall","Remove flooring","Remove trim","Remove baseboards","Remove lighting fixtures","Remove built-in features","Remove chandelier","Remove paint","Remove curtains","Remove outlets"],
    "Home Office":["Remove drywall","Remove flooring","Remove trim","Remove baseboards","Remove built-in desks","Remove lighting fixtures","Remove data outlets","Remove shelving","Remove whiteboards","Remove outlets"],
    "Laundry Room":["Remove washer/dryer","Remove cabinets","Remove sink","Remove plumbing fixtures","Remove flooring","Remove lighting fixtures","Remove ventilation fan","Remove tile","Remove shelving","Remove outlets"],
    "Garage":["Remove drywall","Remove shelving","Remove cabinets","Remove doors","Remove windows","Remove lighting fixtures","Remove electrical fixtures","Remove insulation","Remove hooks","Remove signage"],
    "Basement":["Remove drywall","Remove flooring","Remove insulation","Remove trim","Remove lighting fixtures","Remove windows","Remove sump pump cover","Remove tile","Remove shelving","Remove outlets"],
    "Attic":["Remove insulation","Remove drywall","Remove flooring","Remove vents","Remove lighting fixtures","Remove bracing","Remove panels","Remove wiring","Remove ductwork","Remove hatch"],
    "Patio":["Remove pavers","Remove decking","Remove railings","Remove lighting fixtures","Remove outdoor furniture","Remove pergola","Remove planters","Remove fixtures","Remove coverings","Remove posts"],
    "Deck":["Remove deck boards","Remove railings","Remove stairs","Remove lighting fixtures","Remove posts","Remove joists","Remove skirting","Remove hardware","Remove fascia","Remove supports"],
    "Porch":["Remove flooring","Remove railings","Remove columns","Remove lighting fixtures","Remove door frame","Remove ceiling","Remove trim","Remove steps","Remove fixtures","Remove soffit"],
    "Hallway":["Remove drywall","Remove flooring","Remove trim","Remove baseboards","Remove lighting fixtures","Remove railings","Remove sconces","Remove outlets","Remove vents","Remove doors"],
    "Entryway":["Remove flooring","Remove trim","Remove lighting fixtures","Remove closet shelving","Remove doors","Remove hardware","Remove baseboards","Remove outlets","Remove vents","Remove paint"],
    "Staircase":["Remove treads","Remove risers","Remove handrails","Remove balusters","Remove lighting fixtures","Remove carpet","Remove hardware","Remove trim","Remove landing","Remove fixture"],
    "Exterior Walls":["Remove cladding","Remove siding","Remove fascia","Remove soffit","Remove windows","Remove trim","Remove vents","Remove fixtures","Remove caulking","Remove flashings"],
    "Driveway":["Remove concrete","Remove asphalt","Remove pavers","Remove sealant","Remove markings","Remove curbing","Remove debris","Remove expansion joints","Remove edging","Remove gravel"],
    "Sidewalk":["Remove concrete","Remove pavers","Remove curb","Remove sealant","Remove debris","Remove expansion joints","Remove edging","Remove fixtures","Remove paint","Remove weeds"],
    "Landscaping Area":["Remove plants","Remove mulch","Remove edging","Remove debris","Remove topsoil","Remove pipes","Remove fences","Remove planters","Remove irrigation","Remove fixtures"],
    "Roof":["Remove shingles","Remove underlayment","Remove flashing","Remove gutters","Remove downspouts","Remove vents","Remove skylights","Remove decking","Remove hardware","Remove insulation"]
  };

  let roomCount = 0;
  document.getElementById('addRoomBtn').addEventListener('click', () => {
    const idx = roomCount++;
    const fs = document.createElement('fieldset'); fs.id = `room-${idx}`;
    const lg = document.createElement('legend'); lg.textContent = `Room ${idx+1}`; fs.append(lg);
    const sel = document.createElement('select'); sel.name = `rooms[${idx}][type]`;
    roomList.forEach(r => {
      const o = document.createElement('option'); o.value = r; o.textContent = r; sel.append(o);
    });
    sel.addEventListener('change', () => renderTasks(idx, sel.value)); fs.append(sel);
    const photo = document.createElement('input'); photo.type = 'file'; photo.accept = 'image/*'; photo.capture = 'environment'; photo.name = `rooms[${idx}][photo]`; fs.append(photo);
    const tasksDiv = document.createElement('div'); tasksDiv.id = `tasks-${idx}`; fs.append(tasksDiv);
    const btnCustom = document.createElement('button'); btnCustom.type = 'button'; btnCustom.className = 'btn btn-custom'; btnCustom.textContent = '+ Custom Task';
    btnCustom.addEventListener('click', () => addCustomTask(idx)); fs.append(btnCustom);
    document.getElementById('roomsContainer').prepend(fs);
    renderTasks(idx, roomList[0]);

    // Optional: hook in persistence/photo save if using that feature
  });

  function renderTasks(idx, type) {
    const container = document.getElementById(`tasks-${idx}`); container.innerHTML = '';
    const tasks = standardTasks.concat(roomSpecificTasks[type] || []);
    tasks.forEach(task => {
      const div = document.createElement('div'); div.className = 'task-item';
      const lbl = document.createElement('label');
      const cb = document.createElement('input'); cb.type = 'checkbox'; cb.value = task;
      lbl.append(cb, document.createTextNode(task));
      const ctr = document.createElement('div'); ctr.className = 'task-controls';
      const sel = document.createElement('select');
      ['Dispose','Bring to shop','Store on site'].forEach(opt => {
        const o = document.createElement('option'); o.value = opt; o.textContent = opt; sel.append(o);
      });
      sel.style.display = 'none';
      cb.addEventListener('change', () => sel.style.display = cb.checked ? 'block' : 'none');
      ctr.append(sel); div.append(lbl, ctr);
      container.append(div);
    });
  }

  function addCustomTask(idx) {
    const container = document.getElementById(`tasks-${idx}`);
    const div = document.createElement('div'); div.className = 'task-item';
    const lbl = document.createElement('label');
    const cb = document.createElement('input'); cb.type = 'checkbox';
    const inp = document.createElement('input'); inp.type = 'text'; inp.placeholder = 'Custom task'; inp.style.flex = '1'; inp.style.marginLeft = '8px';
    lbl.append(cb, inp);
    const ctr = document.createElement('div'); ctr.className = 'task-controls';
    const sel = document.createElement('select');
    ['Dispose','Bring to shop','Store on site'].forEach(opt => {
      const o = document.createElement('option'); o.value = opt; o.textContent = opt; sel.append(o);
    });
    sel.style.display = 'none';
    cb.addEventListener('change', () => sel.style.display = cb.checked ? 'block' : 'none');
    ctr.append(sel);
    div.append(lbl, ctr);
    container.append(div);
  }

  let siteCoords = null;
  document.getElementById('captureLocationBtn').addEventListener('click', () => {
    if (!navigator.geolocation) {
      alert('Geolocation not supported on this device.');
      return;
    }
    navigator.geolocation.getCurrentPosition(pos => {
      siteCoords = pos.coords;
      const disp = document.getElementById('siteLocationDisplay');
      disp.textContent = `Latitude: ${pos.coords.latitude.toFixed(6)}, Longitude: ${pos.coords.longitude.toFixed(6)}`;
    }, err => {
      alert('Unable to retrieve location: ' + err.message);
    });
  });
});
</script>
</body>
</html>
